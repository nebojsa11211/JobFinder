<Window x:Class="JobFinder.ApplicationReviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:JobFinder.ViewModels"
        xmlns:local="clr-namespace:JobFinder"
        mc:Ignorable="d"
        Title="Review Application Before Submitting"
        Height="700" Width="800"
        MinHeight="500" MinWidth="600"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BackgroundBrush}"
        d:DataContext="{d:DesignInstance Type=vm:ApplicationReviewViewModel}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <local:InverseBoolToVisibilityConverter x:Key="BoolToVisibilityInverse"/>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Review Your Application" FontSize="24" FontWeight="SemiBold"
                       Foreground="{StaticResource PrimaryBrush}"/>
            <TextBlock Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0">
                <Run Text="Applying to:"/>
                <Run Text="{Binding JobTitle, Mode=OneWay}" FontWeight="SemiBold"/>
                <Run Text="at"/>
                <Run Text="{Binding Company, Mode=OneWay}" FontWeight="SemiBold"/>
            </TextBlock>

            <!-- Confidence Indicator -->
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <TextBlock Text="AI Confidence:" Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,8,0" VerticalAlignment="Center"/>
                <Border CornerRadius="4" Padding="8,2" VerticalAlignment="Center">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Background" Value="#F44336"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                    <Setter Property="Background" Value="#4CAF50"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                    <Setter Property="Background" Value="#FF9800"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding ConfidenceScore, StringFormat='{}{0}%'}"
                                   Foreground="White" FontWeight="SemiBold"/>
                        <TextBlock Text=" - " Foreground="White"/>
                        <TextBlock Text="{Binding ConfidenceLevel}" Foreground="White" FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Warning Banner -->
                <Border Background="#FFF3E0" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="!" FontWeight="Bold" FontSize="18" Foreground="#E65100"
                                   Margin="0,0,12,0" VerticalAlignment="Top"/>
                        <TextBlock TextWrapping="Wrap" Foreground="#E65100">
                            <Run FontWeight="SemiBold">Review carefully before approving.</Run>
                            <LineBreak/>
                            <Run>This application will be submitted to LinkedIn with your account. Make sure all answers are accurate and appropriate.</Run>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Application Message -->
                <Border Background="{StaticResource CardBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Application Message" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,8"/>
                        <TextBlock Text="This message will be sent with your application (if the form has a message field)."
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" Margin="0,0,0,8" TextWrapping="Wrap"/>
                        <TextBox Text="{Binding ApplicationMessage, UpdateSourceTrigger=PropertyChanged}"
                                 Padding="8" FontSize="13"
                                 AcceptsReturn="True" TextWrapping="Wrap"
                                 Height="120" VerticalScrollBarVisibility="Auto"/>
                        <TextBlock Text="{Binding MessageCharacterCount, StringFormat='Characters: {0}'}"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"
                                   Margin="0,4,0,0" HorizontalAlignment="Right"/>
                    </StackPanel>
                </Border>

                <!-- Matching Skills (if any) -->
                <Border Background="{StaticResource CardBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16"
                        Visibility="{Binding HasMatchingSkills, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel>
                        <TextBlock Text="Matching Skills" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,8"/>
                        <ItemsControl ItemsSource="{Binding MatchingSkills}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#E3F2FD" CornerRadius="4" Padding="8,4" Margin="0,0,8,8">
                                        <TextBlock Text="{Binding}" Foreground="{StaticResource PrimaryBrush}" FontSize="12"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Questions Section -->
                <Border Background="{StaticResource CardBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16"
                        Visibility="{Binding HasQuestions, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel>
                        <TextBlock FontWeight="SemiBold" FontSize="16" Margin="0,0,0,12">
                            <Run Text="Questions"/>
                            <Run Text="{Binding QuestionCount, StringFormat='({0})', Mode=OneWay}"
                                 Foreground="{StaticResource TextSecondaryBrush}"/>
                        </TextBlock>

                        <ItemsControl ItemsSource="{Binding Questions}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type vm:QuestionViewModel}">
                                    <Border BorderBrush="#E0E0E0" BorderThickness="0,0,0,1"
                                            Padding="0,12" Margin="0,0,0,8">
                                        <StackPanel>
                                            <!-- Question Header -->
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="{Binding QuestionText}" FontWeight="SemiBold"
                                                           TextWrapping="Wrap"/>
                                                <TextBlock Text="*" Foreground="{StaticResource DangerBrush}"
                                                           Margin="4,0,0,0"
                                                           Visibility="{Binding IsRequired, Converter={StaticResource BoolToVisibility}}"/>
                                            </StackPanel>

                                            <!-- Question Type Badge -->
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <Border Background="#F5F5F5" CornerRadius="2" Padding="4,2" Margin="0,0,8,0">
                                                    <TextBlock Text="{Binding TypeDisplay}" FontSize="10"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </Border>
                                                <TextBlock Text="{Binding PageNumber, StringFormat='Page {0}'}"
                                                           FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>

                                            <!-- Answer Input - Text -->
                                            <TextBox Text="{Binding Answer, UpdateSourceTrigger=PropertyChanged}"
                                                     Padding="8" FontSize="13"
                                                     Visibility="{Binding IsTextInput, Converter={StaticResource BoolToVisibility}}"/>

                                            <!-- Answer Input - TextArea -->
                                            <TextBox Text="{Binding Answer, UpdateSourceTrigger=PropertyChanged}"
                                                     Padding="8" FontSize="13"
                                                     AcceptsReturn="True" TextWrapping="Wrap"
                                                     Height="80" VerticalScrollBarVisibility="Auto"
                                                     Visibility="{Binding IsMultiLine, Converter={StaticResource BoolToVisibility}}"/>

                                            <!-- Answer Input - Select -->
                                            <ComboBox ItemsSource="{Binding Options}"
                                                      SelectedItem="{Binding Answer}"
                                                      Padding="8" FontSize="13"
                                                      Visibility="{Binding IsSelect, Converter={StaticResource BoolToVisibility}}"/>

                                            <!-- Character Count -->
                                            <TextBlock Text="{Binding AnswerCharacterCount, StringFormat='Characters: {0}'}"
                                                       Foreground="{StaticResource TextSecondaryBrush}" FontSize="10"
                                                       Margin="0,4,0,0" HorizontalAlignment="Right"
                                                       Visibility="{Binding IsMultiLine, Converter={StaticResource BoolToVisibility}}"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- No Questions Message -->
                <Border Background="{StaticResource CardBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16"
                        Visibility="{Binding HasQuestions, Converter={StaticResource BoolToVisibilityInverse}}">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="No additional questions detected" FontWeight="SemiBold"
                                   HorizontalAlignment="Center" Margin="0,0,0,4"/>
                        <TextBlock Text="This application only requires standard resume/profile information."
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer Buttons -->
        <Border Grid.Row="2" Margin="0,16,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}">
                    <Run Text="Session ID:"/>
                    <Run Text="{Binding Session.SessionId, Mode=OneWay}" FontSize="10"/>
                </TextBlock>

                <Button Grid.Column="1" Content="Cancel" Style="{StaticResource SecondaryButton}"
                        Margin="0,0,12,0" Padding="24,10"
                        Command="{Binding CancelCommand}"/>

                <Button Grid.Column="2" Content="Approve &amp; Submit" Style="{StaticResource PrimaryButton}"
                        Padding="24,10" FontWeight="SemiBold"
                        Command="{Binding ApproveCommand}"/>
            </Grid>
        </Border>
    </Grid>
</Window>
